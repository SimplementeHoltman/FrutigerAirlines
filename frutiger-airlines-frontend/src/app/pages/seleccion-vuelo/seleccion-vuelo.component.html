<app-navegacion></app-navegacion>

<div class="uk-container">
  <h1>Selección de Asientos</h1>
  <p>Haz clic en los asientos que deseas reservar.</p>

  <div *ngIf="isVip" class="uk-alert-success uk-margin-small" uk-alert>
    <p>Eres usuario VIP. Descuento activo: {{ vipDescuento || 10 }}% en el precio de tus asientos.</p>
  </div>

  <div uk-grid>
    <div class="uk-width-2-3@m">
      <div class="uk-card uk-card-default uk-card-body uk-text-center">

        <h3 class="uk-text-bold" style="color: var(--color-secundario);">Clase de Negocios</h3>
        <div class="uk-margin">
          <div *ngFor="let fila of filasNegocios" class="uk-flex uk-flex-center">
            <span class="uk-width-1-6 uk-text-bold uk-text-right uk-margin-right">{{ fila }}</span>
            <div *ngFor="let asiento of asientosNegocios[fila]"
                 class="asiento uk-flex uk-flex-center uk-flex-middle"
                 [ngClass]="{
                   'estado-Libre': asiento.estado === 'Libre',
                   'estado-Ocupado': asiento.estado === 'Ocupado',
                   'estado-Seleccionado': estaSeleccionado(asiento)
                 }"
                 (click)="toggleSeleccion(asiento)">
              {{ asiento.numero_asiento }}
            </div>
            <span class="uk-width-1-6"></span>
          </div>
        </div>

        <hr class="uk-divider-icon">

        <h3 class="uk-text-bold" style="color: var(--color-acento);">Clase Económica</h3>
        <div class="uk-margin">
          <div *ngFor="let fila of filasEconomica" class="uk-flex uk-flex-center">
            <span class="uk-width-1-6 uk-text-bold uk-text-right uk-margin-right">{{ fila }}</span>
            <div *ngFor="let asiento of asientosEconomica[fila]"
                 class="asiento uk-flex uk-flex-center uk-flex-middle"
                 [ngClass]="{
                   'estado-Libre': asiento.estado === 'Libre',
                   'estado-Ocupado': asiento.estado === 'Ocupado',
                   'estado-Seleccionado': estaSeleccionado(asiento)
                 }"
                 (click)="toggleSeleccion(asiento)">
              {{ asiento.numero_asiento }}
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="uk-width-1-3@m">
      <div class="uk-card uk-card-default uk-card-body uk-box-shadow-medium" style="position: sticky; top: 100px;">
        <h3 class="uk-card-title">Datos de Pasajeros</h3>

        <div *ngIf="seleccion.length === 0" class="uk-text-center uk-text-muted">
          <p>No has seleccionado ningún asiento.</p>
        </div>

        <form [formGroup]="pasajerosForm" (ngSubmit)="confirmarReserva()">
          <div formArrayName="pasajeros">

            <div *ngFor="let asiento of seleccion; let i = index" [formGroupName]="i">
              <div class="uk-card uk-card-secondary uk-card-body uk-card-small uk-margin-bottom">
                <h4 class="uk-margin-remove-top" style="color: white;">
                  Asiento: {{ asiento.numero_asiento }}
                  <span class="uk-text-small">({{ asiento.clase_asiento }})</span>
                </h4>

                <input type="hidden" formControlName="asiento_id">

                <div class="uk-margin-small">
                  <input class="uk-input uk-form-small" type="text" placeholder="Nombre Completo" formControlName="nombre_pasajero" required>
                </div>
                <div class="uk-margin-small">
                  <input class="uk-input uk-form-small" type="text" placeholder="CUI (13 dígitos)" formControlName="cui_pasajero" required maxlength="13">
                </div>
                <div class="uk-margin-small uk-light">
                  <label>
                    <input class="uk-checkbox" type="checkbox" formControlName="tiene_equipaje">
                    ¿Incluye equipaje?
                  </label>
                </div>

                <div *ngIf="cuiErrores[i]" class="uk-alert-danger" uk-alert>
                  <p class="uk-text-small uk-margin-remove">{{ cuiErrores[i] }}</p>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="seleccion.length > 0" class="uk-margin-top">
            <button class="uk-button uk-button-primary uk-width-1-1" type="submit" [disabled]="pasajerosForm.invalid">
              Confirmar Reserva ({{ seleccion.length }} asientos)
            </button>
          </div>

          <div *ngIf="errorReserva" class="uk-alert-danger uk-margin-top" uk-alert>
            <p>{{ errorReserva }}</p>
          </div>
          <div *ngIf="exitoReserva" class="uk-alert-success uk-margin-top" uk-alert>
            <p>{{ exitoReserva }}</p>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>